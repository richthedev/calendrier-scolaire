<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-wep-app-capable" content="yes">
  <title>Calendrier Scolaire</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <style>
    html, body {
      position: relative;
      font-family: Helvetica, sans-serif;
      padding: 0;
      margin: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    body {
      display: flex;
    }
    .left-column {
      width: 40%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .right-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 60%;
    }
    #off_day, #weekend, #school_day, #next_school_day {
      text-align: center;
      width: 100%;
    }
    .child-column {
      width: 50%;
      text-align: center;
    }
    #school_day {font-size: 3vw;}
    #next_school_day {font-size: 1.5vw; color: #999;}
    #off_day, #weekend {font-size: 8vw; }
    #date_day {font-size: 15vw; font-weight: 500;}
    #date_month, #date_year {font-size: 4vw;}
    .children {display: flex; width: 100%;}
    .activity {font-size: 2em;}
    .version {position: absolute; bottom: 4px; right: 4px; color:#aaa;}
    .hidden {display: none !important;}
    .svg {width: 100px; height: 100px}
  </style>
</head>
<body>
  <div class="version">v0.8</div>
  <div class="left-column">
    <div id="date_day"></div>
    <div id="date_month"></div>
    <div id="date_year"></div>
  </div>
  <div class="right-column">
    <div id="school_day">
      <div id="school_day_number"></div>
      <div class="children">
        <div class="child-column simone">
          <h3>Simone</h3>
          <div class="activity" id="simone"></div>
        </div>
        <div class="child-column isaac">
          <h3>Isaac</h3>
          <div class="activity" id="isaac"></div>
        </div>
      </div>
    </div>
    <div id="weekend"><div>C'est la fin de semaine</div><img class="svg" src="sun.svg"></div>
    <div id="off_day"><div>C'est congé</div><img class="svg" src="tada.svg"></div>
    <div id="next_school_day">
      <h3>Demain</h3>
      <div class="children">
        <div class="child-column simone">
          <div class="activity" id="simone_next"></div>
        </div>
        <div class="child-column isaac">
          <div class="activity" id="isaac_next"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    var update = function () {
      var simoneDays = {1: 'Edu', 4: 'Art', 7: 'Edu', 9: 'Art'};
      var isaacDays = {1: 'Anglais', 2: 'Edu', 3: 'Edu', 4: 'Art', 5: 'Anglais', 6: 'Anglais', 8: 'Art', 9: 'Edu', 10: 'Edu'};
      var offDays = [
        new Date(2021, 8, 6, 0, 0, 0, 0),
        new Date(2021, 8, 17, 0, 0, 0, 0),
        new Date(2021, 9, 7, 0, 0, 0, 0),
        new Date(2021, 9, 11, 0, 0, 0, 0),
        new Date(2021, 10, 12, 0, 0, 0, 0),
        new Date(2021, 11, 3, 0, 0, 0, 0),
        new Date(2021, 11, 23, 0, 0, 0, 0),
        new Date(2021, 11, 24, 0, 0, 0, 0),
        new Date(2021, 11, 27, 0, 0, 0, 0),
        new Date(2021, 11, 28, 0, 0, 0, 0),
        new Date(2021, 11, 29, 0, 0, 0, 0),
        new Date(2021, 11, 30, 0, 0, 0, 0),
        new Date(2021, 11, 31, 0, 0, 0, 0),
        new Date(2022, 0, 3, 0, 0, 0, 0),
        new Date(2022, 0, 4, 0, 0, 0, 0),
        new Date(2022, 0, 5, 0, 0, 0, 0),
        new Date(2022, 0, 6, 0, 0, 0, 0),
        new Date(2022, 0, 7, 0, 0, 0, 0),
        new Date(2022, 0, 10, 0, 0, 0, 0),
        new Date(2022, 1, 11, 0, 0, 0, 0),
        new Date(2022, 1, 28, 0, 0, 0, 0),
        new Date(2022, 2, 1, 0, 0, 0, 0),
        new Date(2022, 2, 2, 0, 0, 0, 0),
        new Date(2022, 2, 3, 0, 0, 0, 0),
        new Date(2022, 2, 4, 0, 0, 0, 0),
        new Date(2022, 2, 25, 0, 0, 0, 0),
        new Date(2022, 3, 15, 0, 0, 0, 0),
        new Date(2022, 3, 18, 0, 0, 0, 0),
        new Date(2022, 4, 23, 0, 0, 0, 0)
      ];
      var firstDayOfSchool = new Date(2021, 7, 27, 0, 0, 0, 0);
      var cycleLength = 10;

      var dayNode = document.getElementById('date_day');
      var monthNode = document.getElementById('date_month');
      var yearNode = document.getElementById('date_year');
      var schoolDayNode = document.getElementById('school_day');
      var nextSchoolDayNode = document.getElementById('next_school_day');
      var schoolDayNumberNode = document.getElementById('school_day_number');
      var simoneNode = document.getElementById('simone');
      var simoneNextNode = document.getElementById('simone_next');
      var isaacNode = document.getElementById('isaac');
      var isaacNextNode = document.getElementById('isaac_next');
      var weekendNode = document.getElementById('weekend');
      var offDayNode = document.getElementById('off_day');

      var isWeekend = function(d) { return d.getDay() == 0 || d.getDay() == 6 };
      var isWeekday = function(d) { return d.getDay() != 0 && d.getDay() != 6 };
      var isOffday = function(d) { return offDays.map(Number).indexOf(+d) >= 0 };
      var isSchoolDay = function(d) { return offDays.map(Number).indexOf(+d) < 0 };

      var schoolDayNumber = function(date) {
        var d1 = new Date(firstDayOfSchool.getTime());
        var d2 = new Date(date.getTime());
        d1.setHours(0, 0, 0, 0);
        d2.setHours(0, 0, 0, 0);
        var numOfSchoolDays = 1;

        while(d1 < d2) {
          d1.setDate(d1.getDate() + 1);
          if(isSchoolDay(d1) && isWeekday(d1)) numOfSchoolDays++;
        }

        var number = numOfSchoolDays % cycleLength;
        if(number == 0) number = 10;

        return number;
      }

      var currentDate = new Date();
      currentDate.setHours(0, 0, 0, 0);

      dayNode.textContent = currentDate.getDate();
      monthNode.textContent = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'][currentDate.getMonth()];
      yearNode.textContent = currentDate.getFullYear();

      if(isWeekend(currentDate)) {
        schoolDayNode.classList.add('hidden');
        weekendNode.classList.remove('hidden');
        offDayNode.classList.add('hidden');
      } else if (isOffday(currentDate)) {
        schoolDayNode.classList.add('hidden');
        weekendNode.classList.add('hidden');
        offDayNode.classList.remove('hidden');
      } else {
        schoolDayNode.classList.remove('hidden');
        weekendNode.classList.add('hidden');
        offDayNode.classList.add('hidden');

        var number = schoolDayNumber(currentDate);

        schoolDayNumberNode.textContent = `Nous sommes un jour d'école #${number}`;
        simoneNode.textContent = simoneDays[number] || '-';
        isaacNode.textContent = isaacDays[number] || '-';
      }

      var tomorrowDate = new Date(currentDate);
      tomorrowDate.setHours(0, 0, 0, 0);
      tomorrowDate.setDate(tomorrowDate.getDate() + 1);

      if(isSchoolDay(tomorrowDate)) {
        nextSchoolDayNode.classList.remove('hidden');
        var number = schoolDayNumber(tomorrowDate);
        simoneNextNode.textContent = simoneDays[number] || '-';
        isaacNextNode.textContent = isaacDays[number] || '-';
      } else {
        nextSchoolDayNode.classList.add('hidden');
      }
    }

    update();
    setInterval(update, 3600 * 1000);
  </script>
</body>
</html>
